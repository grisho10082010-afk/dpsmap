<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Карта</title>

  <!-- Leaflet CDN -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- ВАЖНО: относительный путь, НЕ /styles.css -->
  <link rel="stylesheet" href="./styles.css">
</head>

<body>
  <div class="topbar">
    <h1>Карта</h1>
    <button class="btn" id="btnCity">Показать город</button>
    <button class="btn" id="btnPoints">Показать точки</button>
    <span class="note" id="status">Загрузка…</span>
  </div>

  <div id="map"></div>

  <script>
    // Центр по умолчанию (поставь свой, если хочешь)
    const DEFAULT_CENTER = [54.836, 37.61];
    const map = L.map('map').setView(DEFAULT_CENTER, 12);

    // Тайлы мира
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const statusEl = document.getElementById('status');
    statusEl.textContent = 'Карта загружена';

    // Демо-точка, чтобы было видно, что маркеры работают
    const demo = L.marker(DEFAULT_CENTER).addTo(map).bindPopup("Демо-точка (центр)");

    // Кнопки
    document.getElementById('btnCity').onclick = () => map.setView(DEFAULT_CENTER, 12);

    document.getElementById('btnPoints').onclick = async () => {
      // Если у тебя есть публичный API — вставь ссылку:
      // const API_BASE = "https://xxxxx.trycloudflare.com";
      const API_BASE = "";

      if (!API_BASE) {
        alert("Пока нет публичного API. Карта работает, точки будут когда подключим API.");
        return;
      }

      statusEl.textContent = 'Загружаю точки…';
      try {
        const r = await fetch(API_BASE + "/places");
        const places = await r.json();

        let cnt = 0;
        for (const p of places) {
          if (p.lat && p.lon) {
            cnt++;
            L.marker([p.lat, p.lon]).addTo(map).bindPopup(p.name || "точка");
          }
        }
        statusEl.textContent = `Точек: ${cnt}`;
      } catch (e) {
        console.log(e);
        statusEl.textContent = 'Ошибка загрузки точек';
        alert("Не удалось загрузить точки (API недоступен).");
      }
    };
  </script>
</body>
</html>
